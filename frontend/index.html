<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <link href="https://fonts.googleapis.com/css2?family=Rubik&display=swap" rel="stylesheet">
<!-- SweetAlert2 CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

<!-- SweetAlert2 JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <title>vision education centre</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Ø­Ù‚Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div class="password-container">
    <input type="password" id="admin-password" placeholder="Password">
    <!-- <button class="toggle-password" onclick="togglePassword('admin-password', this)">ğŸ‘ï¸</button>   -->
    <button class="button-login" id="login-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
  </div>

  <!-- Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªÙŠ ØªØ¸Ù‡Ø± Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="data-form" style="display: none;">
    <div class="input">
      <input class="clas" type="text" id="name" required>
      <label for="">Name</label>
    </div>

    <div class="input password-container">
      <input class="clas" type="number" id="password" required>
      <!-- <button class="toggle-password" onclick="togglePassword('password', this)">ğŸ‘ï¸</button> -->
      <label for="">Points</label>
    </div>

    <button class="button-add" id="add-row-btn">Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
  </div>

  <!-- Ø§Ù„Ø¨Ø­Ø« -->
  <div class="search">
    <select id="search-category">
      <option value="name">Ø§Ù„Ø¨Ø­Ø« Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³Ù…</option>
      <option value="points">Ø§Ù„Ø¨Ø­Ø« Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·</option>
    </select>
    <input id="search-input" type="text" placeholder="...Ø§Ù„Ø¨Ø­Ø«">
  </div>


  <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Name</th>
        <th>Points</th>
        <th>View</th>
        <th>Delete</th>
        <th>Edit</th>
      </tr>
    </thead>
    <tbody id="data-table">
      <!-- Ø§Ù„ØµÙÙˆÙ ØªÙØ¶Ø§Ù Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ Ù‡Ù†Ø§ -->
    </tbody>
  </table>

  <script>
const nameInput = document.getElementById("name");
   const passwordInput = document.getElementById("password");
   const addRowBtn = document.getElementById("add-row-btn");
   const dataTable = document.getElementById("data-table");
   const loginBtn = document.getElementById("login-btn");
   const adminPasswordInput = document.getElementById("admin-password");
   const dataForm = document.getElementById("data-form");

   const ADMIN_PASSWORD = "1234"; // ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±

   // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
loginBtn.addEventListener("click", () => {
  const enteredPassword = adminPasswordInput.value.trim();
  
  if (enteredPassword === ADMIN_PASSWORD) {
    dataForm.style.display = "block";
    loginBtn.style.display = "none";
    adminPasswordInput.style.display = "none";
  } else {
    Swal.fire({
      icon: 'error',
      title: 'Ø®Ø·Ø£',
      text: 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!',
      confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
    });
  }
});

   // Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„
   // Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„
async function addRow(name, points) {
    const row = document.createElement("tr");
    const index = dataTable.rows.length + 1;

    row.innerHTML = `
        <td>${index}</td>
        <td>${name}</td>
        <td>${points}</td>
        <td><a href="details.html?name=${encodeURIComponent(name)}" class="view-btn">View</a></td>
        <td><button class="delete-btn" data-name="${name}">Delete</button></td>
        <td><button class="edit-btn" id="edit-btn-${name}" data-name="${name}">Edit</button></td>
    `;

    row.querySelector(".delete-btn").addEventListener("click", () => promptForPasswordAndDelete(name));
    row.querySelector(`#edit-btn-${name}`).addEventListener("click", () => promptForPasswordAndEdit(name));

    dataTable.appendChild(row);
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù‚Ø¨Ù„ Ø­Ø°Ù Ø§Ù„ØµÙ
async function promptForPasswordAndDelete(name) {
    const confirmation = confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙØŸ");
    if (!confirmation) return;

    const enteredPassword = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ø­Ø°Ù:");
    if (enteredPassword === ADMIN_PASSWORD) {
        await fetch(`/api/users/${encodeURIComponent(name)}`, { method: 'DELETE' });
        loadTable();
    } else {
        Swal.fire({
            icon: 'error',
            title: 'Ø®Ø·Ø£',
            text: 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!',
            confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
        });
    }
}

// ØªØ¹Ø¯ÙŠÙ„ ØµÙ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
async function promptForPasswordAndEdit(name) {
    const confirmation = confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„ØµÙØŸ");
    if (!confirmation) return;

    const enteredPassword = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ØªØ¹Ø¯ÙŠÙ„:");
    if (enteredPassword === ADMIN_PASSWORD) {
        const newName = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:");
        const newPoints = parseInt(prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:"), 10);

        await fetch(`/api/users/${encodeURIComponent(name)}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name: newName, password: newPoints }),
        });
        loadTable();
    } else {
        Swal.fire({
            icon: 'error',
            title: 'Ø®Ø·Ø£',
            text: 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!',
            confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
        });
    }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„
async function loadTable() {
    const response = await fetch('/api/users');
    const users = await response.json();
    dataTable.innerHTML = ""; // Ù…Ø³Ø­ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    users.forEach(user => addRow(user.name, user.password));
}
   // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©
addRowBtn.addEventListener("click", async () => {
  const name = nameInput.value.trim();
  const password = parseInt(passwordInput.value.trim(), 10);

  if (!name || isNaN(password)) {
    Swal.fire({
      icon: 'error',
      title: 'Ø®Ø·Ø£',
      text: 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­!',
      confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
    });
    return;
  }

  const response = await fetch('/api/users', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name, password }),
  });
  const newUser = await response.json();
  loadTable();
  nameInput.value = "";
  passwordInput.value = "";
});

   // Ø§Ù„Ø¨Ø­Ø«
   document.getElementById("search-input").addEventListener("input", () => {
       const searchCategory = document.getElementById("search-category").value;
       const searchValue = document.getElementById("search-input").value.toLowerCase();

       Array.from(dataTable.rows).forEach(row => {
           const cellValue = row.cells[searchCategory === "name" ? 1 : 2]?.textContent.toLowerCase();
           row.style.display = cellValue && cellValue.includes(searchValue) ? "" : "none";
       });
   });

   window.addEventListener("DOMContentLoaded", loadTable);
  </script>
</body>
</html>